/*!
 * mdui.editor 1.0.2 (https://github.com/zdhxiong/mdui.editor#readme)
 * Copyright 2019-2021 zdhxiong
 * Licensed under MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Editor=e()}(this,function(){"use strict";function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(n){return new this(function(i,t){if(!n||void 0===n.length)return t(new TypeError(typeof n+" "+n+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var o=Array.prototype.slice.call(n);if(0===o.length)return i([]);var r=o.length;function a(e,t){if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){a(e,t)},function(t){o[e]={status:"rejected",reason:t},0==--r&&i(o)})}o[e]={status:"fulfilled",value:t},0==--r&&i(o)}for(var e=0;e<o.length;e++)a(e,o[e])})}!function(){try{return new MouseEvent("test")}catch(t){}function t(t,e){e=e||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(t,e.bubbles,e.cancelable,window,0,e.screenX||0,e.screenY||0,e.clientX||0,e.clientY||0,e.ctrlKey||!1,e.altKey||!1,e.shiftKey||!1,e.metaKey||!1,e.button||0,e.relatedTarget||null),n}t.prototype=Event.prototype,window.MouseEvent=t}(),"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,window.CustomEvent=t);var i=setTimeout;function c(t){return Boolean(t&&void 0!==t.length)}function o(){}function r(t){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(t,this)}function a(n,i){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,r._immediateFn(function(){var t=1===n._state?i.onFulfilled:i.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void u(i.promise,t)}s(i.promise,e)}else(1===n._state?s:u)(i.promise,n._value)})):n._deferreds.push(i)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void l(e);if("function"==typeof n)return void d(function(t,e){return function(){t.apply(e,arguments)}}(n,t),e)}e._state=1,e._value=t,l(e)}catch(t){u(e,t)}}function u(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&r._immediateFn(function(){t._handled||r._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function f(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function d(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var n=new this.constructor(o);return a(this,new f(t,e,n)),n},r.prototype.finally=e,r.all=function(e){return new r(function(i,o){if(!c(e))return o(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(e);if(0===r.length)return i([]);var a=r.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},o)}r[e]=t,0==--a&&i(r)}catch(t){o(t)}}for(var t=0;t<r.length;t++)s(t,r[t])})},r.allSettled=n,r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(n){return new r(function(t,e){e(n)})},r.race=function(o){return new r(function(t,e){if(!c(o))return e(new TypeError("Promise.race accepts an array"));for(var n=0,i=o.length;n<i;n++)r.resolve(o[n]).then(t,e)})},r._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){i(t,0)},r._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();function h(t){return"function"==typeof t}function w(t){return"string"==typeof t}function m(t){return"number"==typeof t}function E(t){return void 0===t}function v(t){return null===t}function g(t){return t instanceof Window}function y(t){return t instanceof Document}function b(t){return t instanceof Element}function x(t){return!h(t)&&!g(t)&&m(t.length)}function R(t){return"object"==typeof t&&null!==t}function _(t){return y(t)?t.documentElement:t}function C(t){return t.replace(/^-ms-/,"ms-").replace(/-([a-z])/g,function(t,e){return e.toUpperCase()})}function T(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}function k(t,e){return window.getComputedStyle(t).getPropertyValue(T(e))}function O(t){return"border-box"===k(t,"box-sizing")}function $(o,t,r){var a="width"===t?["Left","Right"]:["Top","Bottom"];return[0,1].reduce(function(t,e,n){var i=r+a[n];return"border"===r&&(i+="Width"),t+parseFloat(k(o,i)||"0")},0)}function A(t,e){if("width"!==e&&"height"!==e)return k(t,e);var n=t.getBoundingClientRect()[e];return O(t)?n+"px":n-$(t,e,"border")-$(t,e,"padding")+"px"}function H(t,e){var n=document.createElement(e);return n.innerHTML=t,[].slice.call(n.childNodes)}function L(){return!1}"function"!=typeof p.Promise?p.Promise=r:p.Promise.prototype.finally?p.Promise.allSettled||(p.Promise.allSettled=n):p.Promise.prototype.finally=e;var S=["animationIterationCount","columnCount","fillOpacity","flexGrow","flexShrink","fontWeight","gridArea","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","lineHeight","opacity","order","orphans","widows","zIndex","zoom"];function j(t,e){if(x(t)){for(var n=0;n<t.length;n+=1)if(!1===e.call(t[n],n,t[n]))return t}else for(var i=Object.keys(t),o=0;o<i.length;o+=1)if(!1===e.call(t[i[o]],i[o],t[i[o]]))return t;return t}function M(t){var n=this;return this.length=0,t&&(j(t,function(t,e){n[t]=e}),this.length=t.length),this}var N,D=((N=function(t){if(!t)return new M;if(t instanceof M)return t;if(h(t))return/complete|loaded|interactive/.test(document.readyState)&&document.body?t.call(document,N):document.addEventListener("DOMContentLoaded",function(){return t.call(document,N)},!1),new M([document]);if(w(t)){var n=t.trim();if("<"===n[0]&&">"===n[n.length-1]){var i="div";return j({li:"ul",tr:"tbody",td:"tr",th:"tr",tbody:"table",option:"select"},function(t,e){if(0===n.indexOf("<"+t))return i=e,!1}),new M(H(n,i))}if(!("#"===t[0]&&!t.match(/[ .<>:~]/)))return new M(document.querySelectorAll(t));var e=document.getElementById(t.slice(1));return e?new M([e]):new M}return x(t)&&!function(t){return t instanceof Node}(t)?new M(t):new M([t])}).fn=M.prototype,N);function U(n,t){for(var e=[],i=arguments.length-2;0<i--;)e[i]=arguments[i+2];return e.unshift(t),j(e,function(t,e){j(e,function(t,e){E(e)||(n[t]=e)})}),n}function B(t,n){var e,i,o=[];return j(t,function(t,e){null!=(i=n.call(window,e,t))&&o.push(i)}),(e=[]).concat.apply(e,o)}function I(t){var n=[];return j(t,function(t,e){-1===n.indexOf(e)&&n.push(e)}),n}function P(t,e){return t!==e&&_(t).contains(e)}function q(n,t){return j(t,function(t,e){n.push(e)}),n}D.fn.each=function(t){return j(this,t)},j(["add","remove","toggle"],function(t,i){D.fn[i+"Class"]=function(e){return"remove"!==i||arguments.length?this.each(function(t,n){b(n)&&j((h(e)?e.call(n,t,n.getAttribute("class")||""):e).split(" ").filter(function(t){return t}),function(t,e){n.classList[i](e)})}):this.each(function(t,e){e.setAttribute("class","")})}}),j(["insertBefore","insertAfter"],function(s,t){D.fn[t]=function(t){var e=s?D(this.get().reverse()):this,n=D(t),a=[];return n.each(function(o,r){r.parentNode&&e.each(function(t,e){var n=o?e.cloneNode(!0):e,i=s?r.nextSibling:r;a.push(n),r.parentNode.insertBefore(n,i)})}),D(s?a.reverse():a)}}),j(["before","after"],function(o,t){D.fn[t]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return 1===o&&(t=t.reverse()),this.each(function(n,i){j(h(t[0])?[t[0].call(i,n,i.innerHTML)]:t,function(t,e){(function(t){return w(t)&&("<"!==t[0]||">"!==t[t.length-1])}(e)?D(H(e,"div")):n&&b(e)?D(e.cloneNode(!0)):D(e))[o?"insertAfter":"insertBefore"](i)})})}}),D.fn.map=function(n){return new M(B(this,function(t,e){return n.call(t,e,t)}))},D.fn.clone=function(){return this.map(function(){return this.cloneNode(!0)})},D.fn.is=function(n){var i=!1;if(h(n))return this.each(function(t,e){n.call(e,t,e)&&(i=!0)}),i;if(w(n))return this.each(function(t,e){y(e)||g(e)||(e.matches||e.msMatchesSelector).call(e,n)&&(i=!0)}),i;var e=D(n);return this.each(function(t,n){e.each(function(t,e){n===e&&(i=!0)})}),i},D.fn.remove=function(n){return this.each(function(t,e){!e.parentNode||n&&!D(e).is(n)||e.parentNode.removeChild(e)})},j(["prepend","append"],function(c,t){D.fn[t]=function(){for(var s=[],t=arguments.length;t--;)s[t]=arguments[t];return this.each(function(t,e){var n,i=e.childNodes,o=i.length,r=o?i[c?o-1:0]:document.createElement("div");o||e.appendChild(r);var a=h(s[0])?[s[0].call(e,t,e.innerHTML)]:s;t&&(a=a.map(function(t){return w(t)?t:D(t).clone()})),(n=D(r))[c?"after":"before"].apply(n,a),o||e.removeChild(r)})}}),j(["attr","prop","css"],function(r,a){function s(t,e){switch(r){case 0:var n=t.getAttribute(e);return v(n)?void 0:n;case 1:return t[e];default:return A(t,e)}}D.fn[a]=function(n,i){var o=this;if(R(n))return j(n,function(t,e){o[a](t,e)}),this;if(1!==arguments.length)return this.each(function(t,e){!function(t,e,n){if(!E(n))switch(r){case 0:v(n)?t.removeAttribute(e):t.setAttribute(e,n);break;case 1:t[e]=n;break;default:e=C(e),t.style[e]=m(n)?n+(-1<S.indexOf(e)?"":"px"):n}}(e,n,h(i)?i.call(e,t,s(e,n)):i)});var t=this[0];return b(t)?s(t,n):void 0}}),D.fn.children=function(n){var i=[];return this.each(function(t,e){j(e.childNodes,function(t,e){b(e)&&(n&&!D(e).is(n)||i.push(e))})}),new M(I(i))},D.fn.slice=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new M([].slice.apply(this,t))},D.fn.eq=function(t){var e=-1===t?this.slice(t):this.slice(t,+t+1);return new M(e)},D.fn.first=function(){return this.eq(0)},j(["val","html","text"],function(o,t){var r={0:"value",1:"innerHTML",2:"textContent"}[o];function a(t){if(2===o)return B(t,function(t){return _(t)[r]}).join("");if(t.length){var e=t[0];return 0===o&&D(e).is("select[multiple]")?B(D(e).find("option:checked"),function(t){return t.value}):e[r]}}D.fn[t]=function(i){return arguments.length?this.each(function(t,e){var n=h(i)?i.call(e,t,a(D(e))):i;0===o&&Array.isArray(n)?D(e).is("select[multiple]")?B(D(e).find("option"),function(t){return t.selected=-1<n.indexOf(t.value)}):e.checked=-1<n.indexOf(e.value):function(t,e){if(E(e)){if(0!==o)return;e=""}1===o&&b(e)&&(e=e.outerHTML),t[r]=e}(e,n)}):a(this)}}),D.fn.last=function(){return this.eq(-1)},D.fn.get=function(t){return void 0===t?[].slice.call(this):this[0<=t?t:t+this.length]},D.fn.find=function(n){var i=[];return this.each(function(t,e){q(i,D(e.querySelectorAll(n)).get())}),new M(i)};var F={},z=1;function W(t){var e="_mduiEventId";return t[e]||(t[e]=++z),t[e]}function K(t){var e=t.split(".");return{type:e[0],ns:e.slice(1).sort().join(" ")}}function X(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function G(e,t,n,i){function o(t){delete r[t.id],e.removeEventListener(t.type,t.proxy,!1)}var r=F[W(e)]||[];t?t.split(" ").forEach(function(t){t&&function(t,e,n,i){var o=K(e);return(F[W(t)]||[]).filter(function(t){return t&&(!o.type||t.type===o.type)&&(!o.ns||X(o.ns).test(t.ns))&&(!n||W(t.func)===W(n))&&(!i||t.selector===i)})}(e,t,n,i).forEach(function(t){return o(t)})}):r.forEach(function(t){return o(t)})}D.fn.off=function(t,n,e){var i=this;return R(t)?(j(t,function(t,e){i.off(t,n,e)}),this):(!1!==n&&!h(n)||(e=n,n=void 0),!1===e&&(e=L),this.each(function(){G(this,t,e,n)}))},D.fn.on=function(t,n,i,e,o){var r=this;if(R(t))return w(n)||(i=i||n,n=void 0),j(t,function(t,e){r.on(t,n,i,e,o)}),this;if(null==i&&null==e?(e=n,i=n=void 0):null==e&&(w(n)?(e=i,i=void 0):(e=i,i=n,n=void 0)),!1===e)e=L;else if(!e)return this;if(o){var a=this,s=e;e=function(t){return a.off(t.type,n,e),s.apply(this,arguments)}}return this.each(function(){!function(r,t,a,s,c){var u=W(r);F[u]||(F[u]=[]);var l=!1;R(s)&&s.useCapture&&(l=!0),t.split(" ").forEach(function(t){if(t){var n=K(t),e={type:n.type,ns:n.ns,func:a,selector:c,id:F[u].length,proxy:o};F[u].push(e),r.addEventListener(e.type,o,l)}function i(t,e){!1===a.apply(e,void 0===t._detail?[t]:[t].concat(t._detail))&&(t.preventDefault(),t.stopPropagation())}function o(e){e._ns&&!X(e._ns).test(n.ns)||(e._data=s,c?D(r).find(c).get().reverse().forEach(function(t){t!==e.target&&!P(t,e.target)||i(e,t)}):i(e,r))}})}(this,t,e,i,n)})},j(["appendTo","prependTo"],function(a,t){D.fn[t]=function(t){var r=[],e=D(t).map(function(t,e){var n=e.childNodes,i=n.length;if(i)return n[a?0:i-1];var o=document.createElement("div");return e.appendChild(o),r.push(o),o}),n=this[a?"insertBefore":"insertAfter"](e);return D(r).remove(),n}});function V(t){this.editor=t}var J={$toolbar:{configurable:!0},$container:{configurable:!0},selection:{configurable:!0},command:{configurable:!0}};J.$toolbar.get=function(){return this.editor.$toolbar},J.$container.get=function(){return this.editor.$container},J.selection.get=function(){return this.editor.selection},J.command.get=function(){return this.editor.command},Object.defineProperties(V.prototype,J);var Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.do=function(t,e){if(this.selection.getRange()){this.selection.restore();var n=t;this[n]?this[n](e):document.execCommand(t,!1,e),this.editor.menus.changeStatus(),this.selection.saveRange(),this.selection.restore(),this.editor.change&&this.editor.change()}},e.prototype.insertHTML=function(t){if(document.queryCommandSupported("insertHTML"))document.execCommand("insertHTML",!1,t);else{var e=this.selection.getRange();e.insertNode?(e.deleteContents(),e.insertNode(D(t)[0])):e.pasteHTML&&e.pasteHTML(t)}},e.prototype.replaceRoot=function(t){var e=this.selection.getRootElem(),n=D(t).insertAfter(e);e.remove(),this.selection.createRangeByElem(n,!1,!0),this.selection.restore()},e.prototype.insertAfterRoot=function(t){var e=this.selection.getRootElem(),n=D(t).insertAfter(e);this.selection.createRangeByElem(n,!1,!0),this.selection.restore()},e.prototype.appendHTML=function(t){var e=D(t).appendTo(this.$container);this.selection.createRangeByElem(e,!1,!0),this.selection.restore()},e.prototype.insertElem=function(t){var e=this.selection.getRange();e.insertNode&&(e.deleteContents(),e.insertNode(t[0]))},e}(V),Q=function(n){function t(t,e){n.call(this,t),this.$button=e}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.isActive=function(){return!1},t}(V);Q.icon="",Q.title="",Q.disable=[];var Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.isEmpty();t&&this.selection.createEmptyRange(this.getElementName()),this.command.do(this.getCommandName()),t&&(this.selection.collapseRange(),this.selection.restore())},e.prototype.isActive=function(){return document.queryCommandState(this.getCommandName())},e}(Q),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getCommandName=function(){return"bold"},e.prototype.getElementName=function(){return"strong"},e}(Z);tt.icon="format_bold",tt.title="粗体",tt.disable=["image"],setTimeout(function(){return D("body").addClass("mdui-loaded")});var et={$:D},nt=D(document),it=D(window);function ot(e,n,t,i,o,r){function a(t){return $(e,n.toLowerCase(),t)*r}return 2===i&&o&&(t+=a("margin")),O(e)?(window.document.documentMode&&1===r&&(t+=a("border"),t+=a("padding")),0===i&&(t-=a("border")),1===i&&(t-=a("border"),t-=a("padding"))):(0===i&&(t+=a("padding")),2===i&&(t+=a("border"),t+=a("padding"))),t}function rt(t,e,n,i){var o="client"+e,r="scroll"+e,a="offset"+e,s="inner"+e;if(g(t))return 2===n?t[s]:_(document)[o];if(y(t)){var c=_(t);return Math.max(t.body[r],c[r],t.body[a],c[a],c[o])}var u=parseFloat(k(t,e.toLowerCase())||"0");return ot(t,e,u,n,i,1)}D("body"),D.fn.hasClass=function(t){return this[0].classList.contains(t)},j(["Width","Height"],function(t,r){j(["inner"+r,r.toLowerCase(),"outer"+r],function(o,t){D.fn[t]=function(n,t){var e=arguments.length&&(o<2||!function(t){return"boolean"==typeof t}(n)),i=!0===n||!0===t;return e?this.each(function(t,e){return function(t,e,n,i,o,r){var a=h(r)?r.call(t,e,rt(t,n,i,o)):r;if(null!=a){var s=D(t),c=n.toLowerCase();if(-1<["auto","inherit",""].indexOf(a))s.css(c,a);else{var u=a.toString().replace(/\b[0-9.]*/,"");a=ot(t,n,parseFloat(a),i,o,-1)+(u||"px"),s.css(c,a)}}}(e,t,r,o,i,n)}):this.length?rt(this[0],r,o,i):void 0}})}),D.fn.hide=function(){return this.each(function(){this.style.display="none"})};var at={};D.fn.show=function(){return this.each(function(){"none"===this.style.display&&(this.style.display=""),"none"===A(this,"display")&&(this.style.display=function(t){var e,n;return at[t]||(e=document.createElement(t),document.body.appendChild(e),n=A(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),at[t]=n),at[t]}(this.nodeName))})},D.fn.transitionEnd=function(e){var n=this,i=["webkitTransitionEnd","transitionend"];function o(t){t.target===this&&(e.call(this,t),j(i,function(t,e){n.off(e,o)}))}return j(i,function(t,e){n.on(e,o)}),this};var st="_mduiElementDataStorage";function ct(n,t){n[st]||(n[st]={}),j(t,function(t,e){n[st][C(t)]=e})}function ut(t,e,n){var i;return R(e)?(ct(t,e),e):E(n)?E(e)?t[st]?t[st]:{}:(e=C(e),t[st]&&e in t[st]?t[st][e]:void 0):(ct(t,((i={})[e]=n,i)),n)}var lt=/^(?:{[\w\W]*\}|\[[\w\W]*\])$/;function ft(t,e,n){if(E(n)&&1===t.nodeType){var i="data-"+T(e);if(w(n=t.getAttribute(i)))try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:lt.test(t)?JSON.parse(t):t)}(n)}catch(t){}else n=void 0}return n}D.fn.data=function(t,e){if(E(t)){if(!this.length)return;var n=this[0],i=ut(n);if(1!==n.nodeType)return i;for(var o=n.attributes,r=o.length;r--;)if(o[r]){var a=o[r].name;0===a.indexOf("data-")&&(i[a=C(a.slice(5))]=ft(n,a,i[a]))}return i}return R(t)?this.each(function(){ut(this,t)}):2===arguments.length&&E(e)?this:E(e)?this.length?ft(this[0],t,ut(this[0],t)):void 0:this.each(function(){ut(this,t,e)})},D.hideOverlay=function(t){void 0===t&&(t=!1);var e=D(".mdui-overlay");if(e.length){var n=t?1:e.data("_overlay_level");1<n?e.data("_overlay_level",--n):e.data("_overlay_level",0).removeClass("mdui-overlay-show").data("_overlay_is_deleted",!0).transitionEnd(function(){e.data("_overlay_is_deleted")&&e.remove()})}},D.lockScreen=function(){var t=D("body"),e=t.width(),n=t.data("_lockscreen_level")||0;t.addClass("mdui-locked").width(e).data("_lockscreen_level",++n)},D.fn.reflow=function(){return this.each(function(){return this.clientLeft})},D.showOverlay=function(t){var e=D(".mdui-overlay");e.length?(e.data("_overlay_is_deleted",!1),E(t)||e.css("z-index",t)):(E(t)&&(t=2e3),e=D('<div class="mdui-overlay">').appendTo(document.body).reflow().css("z-index",t));var n=e.data("_overlay_level")||0;return e.data("_overlay_level",++n).addClass("mdui-overlay-show")},D.throttle=function(i,o){void 0===o&&(o=16);var r=null;return function(){for(var t=this,e=[],n=arguments.length;n--;)e[n]=arguments[n];v(r)&&(r=setTimeout(function(){i.apply(t,e),r=null},o))}},D.unlockScreen=function(t){void 0===t&&(t=!1);var e=D("body"),n=t?1:e.data("_lockscreen_level");1<n?e.data("_lockscreen_level",--n):e.data("_lockscreen_level",0).removeClass("mdui-locked").width("")},D.fn.trigger=function(t,e){var n,i=K(t),o={bubbles:!0,cancelable:!0},r=-1<["click","mousedown","mouseup","mousemove"].indexOf(i.type);return(n=r?new MouseEvent(i.type,o):(o.detail=e,new CustomEvent(i.type,o)))._detail=e,n._ns=i.ns,this.each(function(){this.dispatchEvent(n)})};var dt={};function pt(t,e){if(E(dt[t])&&(dt[t]=[]),E(e))return dt[t];dt[t].push(e)}function ht(t,e){var n=this;void 0===e&&(e={}),this.options=U({},vt),this.state="closed",this.append=!1,this.$element=D(t).first(),P(document.body,this.$element[0])||(this.append=!0,D("body").append(this.$element)),U(this.options,e),this.$element.find("[mdui-dialog-cancel]").each(function(t,e){D(e).on("click",function(){n.triggerEvent("cancel"),n.options.closeOnCancel&&n.close()})}),this.$element.find("[mdui-dialog-confirm]").each(function(t,e){D(e).on("click",function(){n.triggerEvent("confirm"),n.options.closeOnConfirm&&n.close()})}),this.$element.find("[mdui-dialog-close]").each(function(t,e){D(e).on("click",function(){return n.close()})})}var mt,vt={history:!0,overlay:!0,modal:!1,closeOnEsc:!0,closeOnCancel:!0,closeOnConfirm:!0,destroyOnClosed:!1},gt=null,yt="_mdui_dialog",bt=!1;ht.prototype.triggerEvent=function(t){!function(t,e,n,i,o){(o=o||{}).inst=i;var r=t+".mdui."+e;"undefined"!=typeof jQuery&&jQuery(n).trigger(r,o);var a=D(n);a.trigger(r,o);var s=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:o});s._detail=o,a[0].dispatchEvent(s)}(t,"dialog",this.$element,this)},ht.prototype.readjust=function(){if(gt){var t=gt.$element,e=t.children(".mdui-dialog-title"),n=t.children(".mdui-dialog-content"),i=t.children(".mdui-dialog-actions");t.height(""),n.height("");var o=t.height();t.css({top:(it.height()-o)/2+"px",height:o+"px"}),n.innerHeight(o-(e.innerHeight()||0)-(i.innerHeight()||0))}},ht.prototype.hashchangeEvent=function(){window.location.hash.substring(1).indexOf("mdui-dialog")<0&&gt.close(!0)},ht.prototype.overlayClick=function(t){D(t.target).hasClass("mdui-overlay")&&gt&&gt.close()},ht.prototype.transitionEnd=function(){this.$element.hasClass("mdui-dialog-open")?(this.state="opened",this.triggerEvent("opened")):(this.state="closed",this.triggerEvent("closed"),this.$element.hide(),pt(yt).length||gt||!bt||(D.unlockScreen(),bt=!1),it.off("resize",D.throttle(this.readjust,100)),this.options.destroyOnClosed&&this.destroy())},ht.prototype.doOpen=function(){var t=this;if(gt=this,bt||(D.lockScreen(),bt=!0),this.$element.show(),this.readjust(),it.on("resize",D.throttle(this.readjust,100)),this.state="opening",this.triggerEvent("open"),this.$element.addClass("mdui-dialog-open").transitionEnd(function(){return t.transitionEnd()}),mt=mt||D.showOverlay(5100),this.options.modal?mt.off("click",this.overlayClick):mt.on("click",this.overlayClick),mt.css("opacity",this.options.overlay?"":0),this.options.history){var e=window.location.hash.substring(1);-1<e.indexOf("mdui-dialog")&&(e=e.replace(/[&?]?mdui-dialog/g,"")),window.location.hash=e?e+(-1<e.indexOf("?")?"&":"?")+"mdui-dialog":"mdui-dialog",it.on("hashchange",this.hashchangeEvent)}},ht.prototype.isOpen=function(){return"opening"===this.state||"opened"===this.state},ht.prototype.open=function(){var t=this;this.isOpen()||(gt&&("opening"===gt.state||"opened"===gt.state)||pt(yt).length?pt(yt,function(){return t.doOpen()}):this.doOpen())},ht.prototype.close=function(t){var e=this;void 0===t&&(t=!1),setTimeout(function(){e.isOpen()&&(gt=null,e.state="closing",e.triggerEvent("close"),!pt(yt).length&&mt&&(D.hideOverlay(),mt=null,D(".mdui-overlay").css("z-index",2e3)),e.$element.removeClass("mdui-dialog-open").transitionEnd(function(){return e.transitionEnd()}),e.options.history&&!pt(yt).length&&(t||window.history.back(),it.off("hashchange",e.hashchangeEvent)),setTimeout(function(){!function(t){E(dt[t])||dt[t].length&&dt[t].shift()()}(yt)},100))})},ht.prototype.toggle=function(){this.isOpen()?this.close():this.open()},ht.prototype.getState=function(){return this.state},ht.prototype.destroy=function(){this.append&&this.$element.remove(),pt(yt).length||gt||(mt&&(D.hideOverlay(),mt=null),bt&&(D.unlockScreen(),bt=!1))},ht.prototype.handleUpdate=function(){this.readjust()},nt.on("keydown",function(t){gt&&gt.options.closeOnEsc&&"opened"===gt.state&&27===t.keyCode&&gt.close()}),et.Dialog=ht;var xt={text:"",bold:!1,close:!0,onClick:function(){}},_t={title:"",content:"",buttons:[],stackedButtons:!1,cssClass:"",history:!0,overlay:!0,modal:!1,closeOnEsc:!0,destroyOnClosed:!0,onOpen:function(){},onOpened:function(){},onClose:function(){},onClosed:function(){}},Ct={confirmText:"ok",cancelText:"cancel",history:!0,modal:!(et.dialog=function(n){var t,e;j((n=U({},_t,n)).buttons,function(t,e){n.buttons[t]=U({},xt,e)});var i="";(null===(t=n.buttons)||void 0===t?void 0:t.length)&&(i='<div class="mdui-dialog-actions'+(n.stackedButtons?" mdui-dialog-actions-stacked":"")+'">',j(n.buttons,function(t,e){i+='<a href="javascript:void(0)" class="mdui-btn mdui-ripple mdui-text-color-primary '+(e.bold?"mdui-btn-bold":"")+'">'+e.text+"</a>"}),i+="</div>");var o='<div class="mdui-dialog '+n.cssClass+'">'+(n.title?'<div class="mdui-dialog-title">'+n.title+"</div>":"")+(n.content?'<div class="mdui-dialog-content">'+n.content+"</div>":"")+i+"</div>",r=new et.Dialog(o,{history:n.history,overlay:n.overlay,modal:n.modal,closeOnEsc:n.closeOnEsc,destroyOnClosed:n.destroyOnClosed});return(null===(e=n.buttons)||void 0===e?void 0:e.length)&&r.$element.find(".mdui-dialog-actions .mdui-btn").each(function(t,e){D(e).on("click",function(){n.buttons[t].onClick(r),n.buttons[t].close&&r.close()})}),r.$element.on("open.mdui.dialog",function(){n.onOpen(r)}).on("opened.mdui.dialog",function(){n.onOpened(r)}).on("close.mdui.dialog",function(){n.onClose(r)}).on("closed.mdui.dialog",function(){n.onClosed(r)}),r.open(),r}),closeOnEsc:!0,closeOnCancel:!0,closeOnConfirm:!0};et.confirm=function(t,e,n,i,o){return h(e)&&(o=i,i=n,n=e,e=""),E(n)&&(n=function(){}),E(i)&&(i=function(){}),E(o)&&(o={}),o=U({},Ct,o),et.dialog({title:e,content:t,buttons:[{text:o.cancelText,bold:!1,close:o.closeOnCancel,onClick:i},{text:o.confirmText,bold:!1,close:o.closeOnConfirm,onClick:n}],cssClass:"mdui-dialog-confirm",history:o.history,modal:o.modal,closeOnEsc:o.closeOnEsc})};var wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var e=this;et.confirm("确定要清空内容？",function(){var t=e.editor.options;e.editor.setHTML(""),t.autoSave&&(window.localStorage.removeItem(t.autoSaveKey),t.onClearDrafts())},L,{confirmText:"确定",cancelText:"取消"})},e}(Q);function Et(t){return void 0===t&&(t=""),t.replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")}wt.icon="delete",wt.title="舍弃草稿",D.fn.add=function(t){return new M(I(q(this.get(),D(t).get())))};var Rt=function(n){function t(t,e){n.call(this,t,e),this.active=!1,this.init()}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.init=function(){var n=this;this.$container.on("keydown",function(t){if(13===t.keyCode&&n.active){t.preventDefault();var e=n.selection.getRange().startOffset;n.command.do("insertHTML","\n"),n.selection.saveRange(),n.selection.getRange().startOffset===e&&n.command.do("insertHTML","\n"),n.selection.getContainerElem()[0].scrollLeft=0}9===t.keyCode&&n.active&&(t.preventDefault(),n.command.do("insertHTML","    "))})},t.prototype.onclick=function(){var i=this,t=this.selection.getRootElem();if(this.active){var e=t.text().split("\n"),n="";return e.forEach(function(t){t=Et(t),n=t?"<p>"+t+"</p>"+n:"<p><br></p>"+n}),void this.command.do("replaceRoot",n)}if(t.length){var o=Et(t.text());this.command.do("replaceRoot",o?"<pre><code>"+o+"</code></pre>":"<pre><code><br></code></pre>")}else{var r=this.selection.getRange();if(r.collapsed)this.command.do("appendHTML","<pre><code><br></code></pre>");else{var a="",s=!1,c=D();this.$container.children().each(function(t,e){var n=D(e);return s||(n.is(r.startContainer)||n[0].contains(r.startContainer)||i.$container.is(r.startContainer))&&(s=!0),!(s&&(a+=Et(n.text())+"\n",c=c.add(n),n.is(r.endContainer)||n[0].contains(r.endContainer)))}),c.each(function(t,e){var n=D(e);t<c.length-1&&n.remove()}),this.selection.createRangeByElem(c.last(),!1,!0),this.command.do("replaceRoot","<pre><code>"+a+"</code></pre>")}}},t.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("pre"),this.active},t}(Q);Rt.icon="code",Rt.title="代码块",Rt.disable=["bold","italic","head","ol","ul","link","image"];var Tt=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h2>"+Et(t.text())+"</h2>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h2><br></h2>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h2"),this.active},e}(Q);Tt.icon="title",Tt.title="标题",Tt.disable=["bold","italic","image"];var kt={},Ot="start.mdui.ajax",$t="success.mdui.ajax",At="error.mdui.ajax",Ht="complete.mdui.ajax";function Lt(t){return 0<=["GET","HEAD"].indexOf(t)}function St(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")}function jt(t){var a,s=!1,c={},u=function(t){var n={url:"",method:"GET",data:"",processData:!0,async:!0,cache:!0,username:"",password:"",headers:{},xhrFields:{},statusCode:{},dataType:"text",contentType:"application/x-www-form-urlencoded",timeout:0,global:!0};return j(kt,function(t,e){["beforeSend","success","error","complete","statusCode"].indexOf(t)<0&&!E(e)&&(n[t]=e)}),U({},n,t)}(t),n=u.url||window.location.toString(),l=u.method.toUpperCase(),i=u.data,e=u.processData,f=u.async,d=u.cache,p=u.username,h=u.password,m=u.headers,v=u.xhrFields,g=u.statusCode,y=u.dataType,b=u.contentType,x=u.timeout,_=u.global;function C(t,e,n){for(var i,o,r=[],a=arguments.length-3;0<a--;)r[a]=arguments[a+3];_&&D(document).trigger(t,e),n&&(n in kt&&(i=kt[n].apply(kt,r)),u[n]&&(o=u[n].apply(u,r)),"beforeSend"!==n||!1!==i&&!1!==o||(s=!0))}return!i||!Lt(l)&&!e||w(i)||i instanceof ArrayBuffer||i instanceof Blob||i instanceof Document||i instanceof FormData||(i=function(t){if(!R(t)&&!Array.isArray(t))return"";var e=[];function r(n,i){var o;R(i)?j(i,function(t,e){o=Array.isArray(i)&&!R(e)?"":t,r(n+"["+o+"]",e)}):(o=null==i||""===i?"=":"="+encodeURIComponent(i),e.push(encodeURIComponent(n)+o))}return Array.isArray(t)?j(t,function(){r(this.name,this.value)}):j(t,r),e.join("&")}(i)),i&&Lt(l)&&(n=St(n,i),i=null),new Promise(function(t,e){Lt(l)&&!d&&(n=St(n,"_="+Date.now()));var o,r=new XMLHttpRequest;r.open(l,n,f,p,h),(b||i&&!Lt(l)&&!1!==b)&&r.setRequestHeader("Content-Type",b),"json"===y&&r.setRequestHeader("Accept","application/json, text/javascript"),m&&j(m,function(t,e){E(e)||r.setRequestHeader(t,e+"")}),/^([\w-]+:)?\/\/([^/]+)/.test(n)&&RegExp.$2!==window.location.host||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),v&&j(v,function(t,e){r[t]=e}),c.xhr=r,c.options=u,r.onload=function(){o&&clearTimeout(o);var n,i=200<=r.status&&r.status<300||304===r.status||0===r.status;if(i)if(a=204===r.status||"HEAD"===l?"nocontent":304===r.status?"notmodified":"success","json"===y){try{n="HEAD"===l?void 0:JSON.parse(r.responseText),c.data=n}catch(t){C(At,c,"error",r,a="parsererror"),e(new Error(a))}"parsererror"!==a&&(C($t,c,"success",n,a,r),t(n))}else n="HEAD"===l?void 0:"text"===r.responseType||""===r.responseType?r.responseText:r.response,c.data=n,C($t,c,"success",n,a,r),t(n);else C(At,c,a="error",r,a),e(new Error(a));j([kt.statusCode,g],function(t,e){e&&e[r.status]&&(i?e[r.status](n,a,r):e[r.status](r,a))}),C(Ht,c,"complete",r,a)},r.onerror=function(){o&&clearTimeout(o),C(At,c,"error",r,r.statusText),C(Ht,c,"complete",r,"error"),e(new Error(r.statusText))},r.onabort=function(){var t="abort";o&&(t="timeout",clearTimeout(o)),C(At,c,"error",r,t),C(Ht,c,"complete",r,t),e(new Error(t))},C(Ot,c,"beforeSend",r),s?e(new Error("cancel")):(0<x&&(o=setTimeout(function(){r.abort()},x)),r.send(i))})}function Mt(t,n,i,o,r){var a,s=[];return t.each(function(t,e){for(a=e[i];a&&b(a);){if(2===n){if(o&&D(a).is(o))break;r&&!D(a).is(r)||s.push(a)}else{if(0===n){o&&!D(a).is(o)||s.push(a);break}o&&!D(a).is(o)||s.push(a)}a=a[i]}}),new M(I(s))}j(["","All","Until"],function(n,t){D.fn["next"+t]=function(t,e){return Mt(this,n,"nextElementSibling",t,e)}});var Nt={confirmText:"ok",history:!0,modal:!1,closeOnEsc:!0,closeOnConfirm:!0};et.alert=function(t,e,n,i){return h(e)&&(i=n,n=e,e=""),E(n)&&(n=function(){}),E(i)&&(i={}),i=U({},Nt,i),et.dialog({title:e,content:t,buttons:[{text:i.confirmText,bold:!1,close:i.closeOnConfirm,onClick:n}],cssClass:"mdui-dialog-alert",history:i.history,modal:i.modal,closeOnEsc:i.closeOnEsc})};var Dt={};function Ut(t){for(var e=0;1024<=t;)t/=1024,e++;return t.toFixed(2)+["B","KB","MB","GB","TB"][e]}D.guid=function(t){if(!E(t)&&!E(Dt[t]))return Dt[t];function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var n="_"+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e();return E(t)||(Dt[t]=n),n};var Bt=function(n){function t(t,e){n.call(this,t,e),this.$input=D(),this.inputID=D.guid(),this.suffixs=[],this.accepts=[],this.setAccepts(),this.setInput(),this.bindInputChange(),this.bindKeyboardEvent()}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.bindKeyboardEvent=function(){var r=this;this.$container.on("keydown",function(t){var e=t.keyCode;r.selection.saveRange();var n=r.selection.getContainerElem();if((8===e||46===e)&&n.is("figcaption")){var i=n.html().toLowerCase().trim();i&&"<br>"!==i&&"<br/>"!==i||(n.html(""),t.preventDefault())}if(n.is("figure")&&(8!==e&&46!==e||(r.selection.createRangeByElem(n.next()),n.remove(),r.selection.restore()),t.preventDefault()),13===e&&n.is("figcaption")){var o=r.selection.getRootElem().next();o.length?(r.selection.createRangeByElem(o),r.selection.restore()):r.command.do("insertAfterRoot","<p><br></p>"),t.preventDefault()}}),this.$container.on("keyup",function(t){var e=t.keyCode,n=r.selection.getContainerElem();if((8===e||46===e)&&n.is("figcaption")){var i=n.html().toLowerCase().trim();i&&"<br>"!==i&&"<br/>"!==i||n.html("")}})},t.prototype.setAccepts=function(){this.suffixs=this.editor.options.imageUploadSuffix;var e={png:"image/png",jpg:"image/jpeg",gif:"image/gif"};this.accepts=this.suffixs.map(function(t){return e[t]})},t.prototype.setInput=function(){this.$input=D('<input type="file" id="'+this.inputID+'" name="'+this.editor.options.imageUploadName+'" accept="'+this.accepts.join(", ")+'"/>').insertAfter(this.$button)},t.prototype.bindInputChange=function(){var n=this;this.$input.on("change",function(t){var e=t.target.files;e.length&&(n.upload(e[0]),n.$input.val(""))})},t.prototype.upload=function(t){var o=this;if(this.accepts.indexOf(t.type)<0)et.alert("仅允许上传 "+this.suffixs.join(", ")+" 格式的图片");else if(this.editor.options.imageUploadMaxSize&&t.size>this.editor.options.imageUploadMaxSize)et.alert("图片体积不能超过 "+Ut(this.editor.options.imageUploadMaxSize));else{var n,i,r,e=new FormData;e.append(this.editor.options.imageUploadName,t),jt({url:this.editor.options.imageUploadUrl,method:"POST",data:e,processData:!1,dataType:"json",contentType:!1,global:!1,beforeSend:function(t){i=0,r=setInterval(function(){return i+=100},100);var e=(n=et.dialog({title:"上传中…",content:'<p class="mdui_editor-upload-progress">0%</p>',history:!1,modal:!0,cssClass:"mdui_editor-upload-progress-dialog"})).$element.find(".mdui_editor-upload-progress");t.upload.onprogress=function(t){e.html((t.loaded/t.total*100).toFixed(0)+"%")}},complete:function(){clearInterval(r),i<500?setTimeout(function(){n.close()},500-i):n.close()}}).then(function(t){if(o.editor.options.imageUploadResponseTransform&&(t=o.editor.options.imageUploadResponseTransform(t)),t.code)et.alert(t.message);else{var e=o.selection.getRootElem(),n=e.html().toLowerCase().trim(),i='<figure><img src="'+t.data.url+'"/><figcaption placeholder="图片描述（选填）"></figcaption></figure>';"P"!==e[0].nodeName||"<br>"!==n&&"<br/>"!==n?o.command.do("insertAfterRoot",i):o.command.do("replaceRoot",i),o.command.do("insertAfterRoot","<p><br></p>")}}).catch(function(){return et.alert("图片上传失败")})}},t.prototype.onclick=function(){D("#"+this.inputID).trigger("click")},t}(Q);Bt.icon="image",Bt.title="插入图片";var It=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getCommandName=function(){return"italic"},e.prototype.getElementName=function(){return"em"},e}(Z);It.icon="format_italic",It.title="斜体",It.disable=["image"],j(["","s","sUntil"],function(n,t){D.fn["parent"+t]=function(t,e){return Mt(n?D(this.get().reverse()):this,n,"parentNode",t,e)}});var Pt={};function qt(t,e,n,i){var o=ut(i,"_mdui_mutation");o||ut(i,"_mdui_mutation",o=[]),-1===o.indexOf(t)&&(o.push(t),e.call(i,n,i))}D.fn.mutation=function(){return this.each(function(t,e){var o=D(e);j(Pt,function(n,i){o.is(n)&&qt(n,i,t,e),o.find(n).each(function(t,e){qt(n,i,t,e)})})})};var Ft={reInit:!(et.mutation=function(n,i){E(n)||E(i)?D(document).mutation():(Pt[n]=i,D(n).each(function(t,e){return qt(n,i,t,e)}))}),domLoadedEvent:!1};function zt(t,e){void 0===e&&(e={}),e=U({},Ft,e);var n=t.target,i=D(n),o=t.type,r=i.val(),a=i.attr("type")||"";if(!(-1<["checkbox","button","submit","range","radio","image"].indexOf(a))){var s=i.parent(".mdui-textfield");if("focus"===o&&s.addClass("mdui-textfield-focus"),"blur"===o&&s.removeClass("mdui-textfield-focus"),"blur"!==o&&"input"!==o||(r?s.addClass("mdui-textfield-not-empty"):s.removeClass("mdui-textfield-not-empty")),n.disabled?s.addClass("mdui-textfield-disabled"):s.removeClass("mdui-textfield-disabled"),"input"!==o&&"blur"!==o||e.domLoadedEvent||!n.validity||(n.validity.valid?s.removeClass("mdui-textfield-invalid-html5"):s.addClass("mdui-textfield-invalid-html5")),i.is("textarea")){var c=r,u=!1;""===c.replace(/[\r\n]/g,"")&&(i.val(" "+c),u=!0),i.outerHeight("");var l=i.outerHeight(),f=n.scrollHeight;l<f&&i.outerHeight(f),u&&i.val(c)}e.reInit&&s.find(".mdui-textfield-counter").remove();var d=i.attr("maxlength");d&&((e.reInit||e.domLoadedEvent)&&D('<div class="mdui-textfield-counter"><span class="mdui-textfield-counter-inputed"></span> / '+d+"</div>").appendTo(s),s.find(".mdui-textfield-counter-inputed").text(r.length.toString())),(s.find(".mdui-textfield-helper").length||s.find(".mdui-textfield-error").length||d)&&s.addClass("mdui-textfield-has-bottom")}}D(function(){nt.on("input focus blur",".mdui-textfield-input",{useCapture:!0},zt),nt.on("click",".mdui-textfield-expandable .mdui-textfield-icon",function(){D(this).parents(".mdui-textfield").addClass("mdui-textfield-expanded").find(".mdui-textfield-input")[0].focus()}),nt.on("click",".mdui-textfield-expanded .mdui-textfield-close",function(){D(this).parents(".mdui-textfield").removeClass("mdui-textfield-expanded").find(".mdui-textfield-input").val("")}),et.mutation(".mdui-textfield",function(){D(this).find(".mdui-textfield-input").trigger("input",{domLoadedEvent:!0})})});var Wt={confirmText:"ok",cancelText:"cancel",history:!0,modal:!(et.updateTextFields=function(t){(E(t)?D(".mdui-textfield"):D(t)).each(function(t,e){D(e).find(".mdui-textfield-input").trigger("input",{reInit:!0})})}),closeOnEsc:!0,closeOnCancel:!0,closeOnConfirm:!0,type:"text",maxlength:0,defaultValue:"",confirmOnEnter:!1};et.prompt=function(t,e,i,n,o){h(e)&&(o=n,n=i,i=e,e=""),E(i)&&(i=function(){}),E(n)&&(n=function(){}),E(o)&&(o={});var r='<div class="mdui-textfield">'+(t?'<label class="mdui-textfield-label">'+t+"</label>":"")+("text"===(o=U({},Wt,o)).type?'<input class="mdui-textfield-input" type="text" value="'+o.defaultValue+'" '+(o.maxlength?'maxlength="'+o.maxlength+'"':"")+"/>":"")+("textarea"===o.type?'<textarea class="mdui-textfield-input" '+(o.maxlength?'maxlength="'+o.maxlength+'"':"")+">"+o.defaultValue+"</textarea>":"")+"</div>";return et.dialog({title:e,content:r,buttons:[{text:o.cancelText,bold:!1,close:o.closeOnCancel,onClick:function(t){var e=t.$element.find(".mdui-textfield-input").val();n(e,t)}},{text:o.confirmText,bold:!1,close:o.closeOnConfirm,onClick:function(t){var e=t.$element.find(".mdui-textfield-input").val();i(e,t)}}],cssClass:"mdui-dialog-prompt",history:o.history,modal:o.modal,closeOnEsc:o.closeOnEsc,onOpen:function(n){var t=n.$element.find(".mdui-textfield-input");et.updateTextFields(t),t[0].focus(),"textarea"!==o.type&&!0===o.confirmOnEnter&&t.on("keydown",function(t){if(13===t.keyCode){var e=n.$element.find(".mdui-textfield-input").val();return i(e,n),o.closeOnConfirm&&n.close(),!1}}),"textarea"===o.type&&t.on("input",function(){return n.handleUpdate()}),o.maxlength&&n.handleUpdate()}})};var Kt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var i=this,t=this.selection.getContainerElem(),e="";t.is("a")&&(this.selection.createRangeByElem(t,!1,!0),e=t.attr("href")||"");var n=et.prompt("请输入链接地址",function(t,e){if(!t)return i.command.do("unlink"),void e.close();var n=e.$element.find(".mdui-textfield-input")[0];return n.validity&&n.validity.valid?(i.command.do("createLink",t),void e.close()):void 0},L,{confirmText:"确认",cancelText:"取消",defaultValue:e,confirmOnEnter:!0,closeOnConfirm:!1});n.$element.find(".mdui-textfield-input").attr("type","text").attr("pattern","^(https?|ftp|file)://[\\S]+\\.[\\S]+$").after('<div class="mdui-textfield-error">链接格式错误</div>'),et.updateTextFields(n.$element.find(".mdui-textfield")),n.handleUpdate()},e.prototype.isActive=function(){return this.selection.getContainerElem().is("a")},e}(Q);Kt.icon="link",Kt.title="插入链接",Kt.disable=["image"],j(["","All","Until"],function(n,t){D.fn["prev"+t]=function(t,e){return Mt(n?D(this.get().reverse()):this,n,"previousElementSibling",t,e)}});var Xt=function(t){function e(){t.apply(this,arguments),this.disable=["head","code","image"]}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getCommandName=function(){return"ol"===this.getName()?"insertOrderedList":"insertUnorderedList"},e.prototype.moveListToRoot=function(t){var i=this;t.each(function(t,e){var n=D(e).parent();n.is(i.$container)||(i.selection.createRangeByElem(n,!1,!0),i.command.do("replaceRoot",e))})},e.prototype.moveElemToP=function(){var s=this;D(this.$container[0].childNodes).each(function(t,e){var n=D(e),i=e.nodeType,o=e.nodeName,r=e.nodeValue,a=e.outerHTML;return 3===i?(s.selection.createRangeByElem(n.prev(),!1,!0),s.command.do("insertAfterRoot",r?"<p>"+r+"</p>":"<p><br></p>"),void n.remove()):1===i?-1<["B","STRONG","I","EM","A"].indexOf(o)?(s.selection.createRangeByElem(n,!1,!0),void s.command.do("replaceRoot",a?"<p>"+a+"</p>":"<p><br></p>")):void("BR"===o&&n.remove()):void 0})},e.prototype.onclick=function(){this.command.do(this.getCommandName()),this.moveListToRoot(this.$container.find(this.getName())),this.moveElemToP()},e.prototype.isActive=function(){return document.queryCommandState(this.getCommandName())},e}(Q),Gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getName=function(){return"ol"},e}(Xt);Gt.icon="format_list_numbered",Gt.title="有序列表";var Vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getName=function(){return"ul"},e}(Xt);Vt.icon="format_list_bulleted",Vt.title="无序列表";var Jt=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h1>"+Et(t.text())+"</h1>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h1><br></h1>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h1"),this.active},e}(Q);Jt.icon="title",Jt.title="H1样式",Jt.disable=["bold","italic","image"];var Yt=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h2>"+Et(t.text())+"</h2>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h2><br></h2>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h2"),this.active},e}(Q);Yt.icon="title",Yt.title="H2样式",Yt.disable=["bold","italic","image"];var Qt=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h3>"+Et(t.text())+"</h3>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h3><br></h3>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h3"),this.active},e}(Q);Qt.icon="title",Qt.title="H3样式",Qt.disable=["bold","italic","image"];var Zt=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h4>"+Et(t.text())+"</h4>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h4><br></h4>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h4"),this.active},e}(Q);Zt.icon="title",Zt.title="H4样式",Zt.disable=["bold","italic","image"];var te=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h5>"+Et(t.text())+"</h5>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h5><br></h5>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h5"),this.active},e}(Q);te.icon="title",te.title="H5样式",te.disable=["bold","italic","image"];var ee=function(t){function e(){t.apply(this,arguments),this.active=!1}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var t=this.selection.getRootElem();if(this.active){var e=t.text();this.command.do("replaceRoot",e?"<p>"+e+"</p>":"<p><br></p>")}else{if(t.length)this.command.do("replaceRoot","<h6>"+Et(t.text())+"</h6>");else this.selection.getRange().collapsed&&this.command.do("appendHTML","<h6><br></h6>")}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().is("h6"),this.active},e}(Q);function ne(t){return"function"==typeof t}function ie(t){return"string"==typeof t}function oe(t){return"number"==typeof t}function re(t){return void 0===t}function ae(t){return null===t}function se(t){return t instanceof Window}function ce(t){return t instanceof Document}function ue(t){return t instanceof Element}function le(t){return!ne(t)&&!se(t)&&oe(t.length)}function fe(t){return"object"==typeof t&&null!==t}function de(t){return ce(t)?t.documentElement:t}function pe(t){return t.replace(/^-ms-/,"ms-").replace(/-([a-z])/g,function(t,e){return e.toUpperCase()})}function he(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}function me(t,e){return window.getComputedStyle(t).getPropertyValue(he(e))}function ve(t){return"border-box"===me(t,"box-sizing")}function ge(o,t,r){var a="width"===t?["Left","Right"]:["Top","Bottom"];return[0,1].reduce(function(t,e,n){var i=r+a[n];return"border"===r&&(i+="Width"),t+parseFloat(me(o,i)||"0")},0)}function ye(t,e){if("width"!==e&&"height"!==e)return me(t,e);var n=t.getBoundingClientRect()[e];return ve(t)?n+"px":n-ge(t,e,"border")-ge(t,e,"padding")+"px"}function be(t,e){var n=document.createElement(e);return n.innerHTML=t,[].slice.call(n.childNodes)}function xe(){return!1}ee.icon="title",ee.title="H6样式",ee.disable=["bold","italic","image"];var _e=["animationIterationCount","columnCount","fillOpacity","flexGrow","flexShrink","fontWeight","gridArea","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","lineHeight","opacity","order","orphans","widows","zIndex","zoom"];function Ce(t,e){if(le(t)){for(var n=0;n<t.length;n+=1)if(!1===e.call(t[n],n,t[n]))return t}else for(var i=Object.keys(t),o=0;o<i.length;o+=1)if(!1===e.call(t[i[o]],i[o],t[i[o]]))return t;return t}function we(t){var n=this;return this.length=0,t&&(Ce(t,function(t,e){n[t]=e}),this.length=t.length),this}var Ee,Re=((Ee=function(t){if(!t)return new we;if(t instanceof we)return t;if(ne(t))return/complete|loaded|interactive/.test(document.readyState)&&document.body?t.call(document,Ee):document.addEventListener("DOMContentLoaded",function(){return t.call(document,Ee)},!1),new we([document]);if(ie(t)){var n=t.trim();if("<"===n[0]&&">"===n[n.length-1]){var i="div";return Ce({li:"ul",tr:"tbody",td:"tr",th:"tr",tbody:"table",option:"select"},function(t,e){if(0===n.indexOf("<"+t))return i=e,!1}),new we(be(n,i))}if(!("#"===t[0]&&!t.match(/[ .<>:~]/)))return new we(document.querySelectorAll(t));var e=document.getElementById(t.slice(1));return e?new we([e]):new we}return le(t)&&!function(t){return t instanceof Node}(t)?new we(t):new we([t])}).fn=we.prototype,Ee);function Te(t,e){return t!==e&&de(t).contains(e)}function ke(n,t){return Ce(t,function(t,e){n.push(e)}),n}Re.fn.each=function(t){return Ce(this,t)},Re.fn.get=function(t){return void 0===t?[].slice.call(this):this[0<=t?t:t+this.length]},Re.fn.find=function(n){var i=[];return this.each(function(t,e){ke(i,Re(e.querySelectorAll(n)).get())}),new we(i)};var Oe={},$e=1;function Ae(t){var e="_mduiEventId";return t[e]||(t[e]=++$e),t[e]}function He(t){var e=t.split(".");return{type:e[0],ns:e.slice(1).sort().join(" ")}}function Le(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function Se(e,t,n,i){function o(t){delete r[t.id],e.removeEventListener(t.type,t.proxy,!1)}var r=Oe[Ae(e)]||[];t?t.split(" ").forEach(function(t){t&&function(t,e,n,i){var o=He(e);return(Oe[Ae(t)]||[]).filter(function(t){return t&&(!o.type||t.type===o.type)&&(!o.ns||Le(o.ns).test(t.ns))&&(!n||Ae(t.func)===Ae(n))&&(!i||t.selector===i)})}(e,t,n,i).forEach(function(t){return o(t)})}):r.forEach(function(t){return o(t)})}function je(n,t){for(var e=[],i=arguments.length-2;0<i--;)e[i]=arguments[i+2];return e.unshift(t),Ce(e,function(t,e){Ce(e,function(t,e){re(e)||(n[t]=e)})}),n}function Me(t){if(!fe(t)&&!Array.isArray(t))return"";var e=[];function r(n,i){var o;fe(i)?Ce(i,function(t,e){o=Array.isArray(i)&&!fe(e)?"":t,r(n+"["+o+"]",e)}):(o=null==i||""===i?"=":"="+encodeURIComponent(i),e.push(encodeURIComponent(n)+o))}return Array.isArray(t)?Ce(t,function(){r(this.name,this.value)}):Ce(t,r),e.join("&")}Re.fn.trigger=function(t,e){var n,i=He(t),o={bubbles:!0,cancelable:!0},r=-1<["click","mousedown","mouseup","mousemove"].indexOf(i.type);return(n=r?new MouseEvent(i.type,o):(o.detail=e,new CustomEvent(i.type,o)))._detail=e,n._ns=i.ns,this.each(function(){this.dispatchEvent(n)})};var Ne={},De={ajaxStart:"start.mdui.ajax",ajaxSuccess:"success.mdui.ajax",ajaxError:"error.mdui.ajax",ajaxComplete:"complete.mdui.ajax"};function Ue(t){return 0<=["GET","HEAD"].indexOf(t)}function Be(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")}Re.ajax=function(t){var a,s=!1,c={},u=function(t){var n={url:"",method:"GET",data:"",processData:!0,async:!0,cache:!0,username:"",password:"",headers:{},xhrFields:{},statusCode:{},dataType:"text",contentType:"application/x-www-form-urlencoded",timeout:0,global:!0};return Ce(Ne,function(t,e){["beforeSend","success","error","complete","statusCode"].indexOf(t)<0&&!re(e)&&(n[t]=e)}),je({},n,t)}(t),n=u.url||window.location.toString(),l=u.method.toUpperCase(),i=u.data,e=u.processData,f=u.async,d=u.cache,p=u.username,h=u.password,m=u.headers,v=u.xhrFields,g=u.statusCode,y=u.dataType,b=u.contentType,x=u.timeout,_=u.global;function C(t,e,n){for(var i,o,r=[],a=arguments.length-3;0<a--;)r[a]=arguments[a+3];_&&Re(document).trigger(t,e),n&&(n in Ne&&(i=Ne[n].apply(Ne,r)),u[n]&&(o=u[n].apply(u,r)),"beforeSend"!==n||!1!==i&&!1!==o||(s=!0))}return!i||!Ue(l)&&!e||ie(i)||i instanceof ArrayBuffer||i instanceof Blob||i instanceof Document||i instanceof FormData||(i=Me(i)),i&&Ue(l)&&(n=Be(n,i),i=null),new Promise(function(t,e){Ue(l)&&!d&&(n=Be(n,"_="+Date.now()));var o,r=new XMLHttpRequest;r.open(l,n,f,p,h),(b||i&&!Ue(l)&&!1!==b)&&r.setRequestHeader("Content-Type",b),"json"===y&&r.setRequestHeader("Accept","application/json, text/javascript"),m&&Ce(m,function(t,e){re(e)||r.setRequestHeader(t,e+"")}),/^([\w-]+:)?\/\/([^/]+)/.test(n)&&RegExp.$2!==window.location.host||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),v&&Ce(v,function(t,e){r[t]=e}),c.xhr=r,c.options=u,r.onload=function(){o&&clearTimeout(o);var n,i=200<=r.status&&r.status<300||304===r.status||0===r.status;if(i)if(a=204===r.status||"HEAD"===l?"nocontent":304===r.status?"notmodified":"success","json"===y){try{n="HEAD"===l?void 0:JSON.parse(r.responseText),c.data=n}catch(t){C(De.ajaxError,c,"error",r,a="parsererror"),e(new Error(a))}"parsererror"!==a&&(C(De.ajaxSuccess,c,"success",n,a,r),t(n))}else n="HEAD"===l?void 0:"text"===r.responseType||""===r.responseType?r.responseText:r.response,c.data=n,C(De.ajaxSuccess,c,"success",n,a,r),t(n);else C(De.ajaxError,c,a="error",r,a),e(new Error(a));Ce([Ne.statusCode,g],function(t,e){e&&e[r.status]&&(i?e[r.status](n,a,r):e[r.status](r,a))}),C(De.ajaxComplete,c,"complete",r,a)},r.onerror=function(){o&&clearTimeout(o),C(De.ajaxError,c,"error",r,r.statusText),C(De.ajaxComplete,c,"complete",r,"error"),e(new Error(r.statusText))},r.onabort=function(){var t="abort";o&&(t="timeout",clearTimeout(o)),C(De.ajaxError,c,"error",r,t),C(De.ajaxComplete,c,"complete",r,t),e(new Error(t))},C(De.ajaxStart,c,"beforeSend",r),s?e(new Error("cancel")):(0<x&&(o=setTimeout(function(){r.abort()},x)),r.send(i))})},Re.ajaxSetup=function(t){return je(Ne,t)},Re.contains=Te;var Ie="_mduiElementDataStorage";function Pe(n,t){n[Ie]||(n[Ie]={}),Ce(t,function(t,e){n[Ie][pe(t)]=e})}function qe(t,e,n){var i;return fe(e)?(Pe(t,e),e):re(n)?re(e)?t[Ie]?t[Ie]:{}:(e=pe(e),t[Ie]&&e in t[Ie]?t[Ie][e]:void 0):(Pe(t,((i={})[e]=n,i)),n)}function Fe(t,n){var e,i,o=[];return Ce(t,function(t,e){null!=(i=n.call(window,e,t))&&o.push(i)}),(e=[]).concat.apply(e,o)}function ze(e,t){if(e[Ie]){var n=function(t){t=pe(t),e[Ie][t]&&(e[Ie][t]=null,delete e[Ie][t])};re(t)?(e[Ie]=null,delete e[Ie]):ie(t)?t.split(" ").filter(function(t){return t}).forEach(function(t){return n(t)}):Ce(t,function(t,e){return n(e)})}}function We(t){var n=[];return Ce(t,function(t,e){-1===n.indexOf(e)&&n.push(e)}),n}function Ke(t,n,i,o,r){var a,s=[];return t.each(function(t,e){for(a=e[i];a&&ue(a);){if(2===n){if(o&&Re(a).is(o))break;r&&!Re(a).is(r)||s.push(a)}else{if(0===n){o&&!Re(a).is(o)||s.push(a);break}o&&!Re(a).is(o)||s.push(a)}a=a[i]}}),new we(We(s))}Re.data=qe,Re.each=Ce,Re.extend=function(){for(var n=this,t=[],e=arguments.length;e--;)t[e]=arguments[e];return 1===t.length?(Ce(t[0],function(t,e){n[t]=e}),this):je.apply(void 0,[t.shift(),t.shift()].concat(t))},Re.map=Fe,Re.merge=ke,Re.param=Me,Re.removeData=ze,Re.unique=We,Re.fn.add=function(t){return new we(We(ke(this.get(),Re(t).get())))},Ce(["add","remove","toggle"],function(t,i){Re.fn[i+"Class"]=function(e){return"remove"!==i||arguments.length?this.each(function(t,n){ue(n)&&Ce((ne(e)?e.call(n,t,n.getAttribute("class")||""):e).split(" ").filter(function(t){return t}),function(t,e){n.classList[i](e)})}):this.each(function(t,e){e.setAttribute("class","")})}}),Ce(["insertBefore","insertAfter"],function(s,t){Re.fn[t]=function(t){var e=s?Re(this.get().reverse()):this,n=Re(t),a=[];return n.each(function(o,r){r.parentNode&&e.each(function(t,e){var n=o?e.cloneNode(!0):e,i=s?r.nextSibling:r;a.push(n),r.parentNode.insertBefore(n,i)})}),Re(s?a.reverse():a)}}),Ce(["before","after"],function(o,t){Re.fn[t]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return 1===o&&(t=t.reverse()),this.each(function(n,i){Ce(ne(t[0])?[t[0].call(i,n,i.innerHTML)]:t,function(t,e){(function(t){return ie(t)&&("<"!==t[0]||">"!==t[t.length-1])}(e)?Re(be(e,"div")):n&&ue(e)?Re(e.cloneNode(!0)):Re(e))[o?"insertAfter":"insertBefore"](i)})})}}),Re.fn.off=function(t,n,e){var i=this;return fe(t)?(Ce(t,function(t,e){i.off(t,n,e)}),this):(!1!==n&&!ne(n)||(e=n,n=void 0),!1===e&&(e=xe),this.each(function(){Se(this,t,e,n)}))},Re.fn.on=function(t,n,i,e,o){var r=this;if(fe(t))return ie(n)||(i=i||n,n=void 0),Ce(t,function(t,e){r.on(t,n,i,e,o)}),this;if(null==i&&null==e?(e=n,i=n=void 0):null==e&&(ie(n)?(e=i,i=void 0):(e=i,i=n,n=void 0)),!1===e)e=xe;else if(!e)return this;if(o){var a=this,s=e;e=function(t){return a.off(t.type,n,e),s.apply(this,arguments)}}return this.each(function(){!function(r,t,a,s,c){var u=Ae(r);Oe[u]||(Oe[u]=[]);var l=!1;fe(s)&&s.useCapture&&(l=!0),t.split(" ").forEach(function(t){if(t){var n=He(t),e={type:n.type,ns:n.ns,func:a,selector:c,id:Oe[u].length,proxy:o};Oe[u].push(e),r.addEventListener(e.type,o,l)}function i(t,e){!1===a.apply(e,void 0===t._detail?[t]:[t].concat(t._detail))&&(t.preventDefault(),t.stopPropagation())}function o(e){e._ns&&!Le(e._ns).test(n.ns)||(e._data=s,c?Re(r).find(c).get().reverse().forEach(function(t){t!==e.target&&!Te(t,e.target)||i(e,t)}):i(e,r))}})}(this,t,e,i,n)})},Ce(De,function(t,e){Re.fn[t]=function(n){return this.on(e,function(t,e){n(t,e.xhr,e.options,e.data)})}}),Re.fn.map=function(n){return new we(Fe(this,function(t,e){return n.call(t,e,t)}))},Re.fn.clone=function(){return this.map(function(){return this.cloneNode(!0)})},Re.fn.is=function(n){var i=!1;if(ne(n))return this.each(function(t,e){n.call(e,t,e)&&(i=!0)}),i;if(ie(n))return this.each(function(t,e){ce(e)||se(e)||(e.matches||e.msMatchesSelector).call(e,n)&&(i=!0)}),i;var e=Re(n);return this.each(function(t,n){e.each(function(t,e){n===e&&(i=!0)})}),i},Re.fn.remove=function(n){return this.each(function(t,e){!e.parentNode||n&&!Re(e).is(n)||e.parentNode.removeChild(e)})},Ce(["prepend","append"],function(c,t){Re.fn[t]=function(){for(var s=[],t=arguments.length;t--;)s[t]=arguments[t];return this.each(function(t,e){var n,i=e.childNodes,o=i.length,r=o?i[c?o-1:0]:document.createElement("div");o||e.appendChild(r);var a=ne(s[0])?[s[0].call(e,t,e.innerHTML)]:s;t&&(a=a.map(function(t){return ie(t)?t:Re(t).clone()})),(n=Re(r))[c?"after":"before"].apply(n,a),o||e.removeChild(r)})}}),Ce(["appendTo","prependTo"],function(a,t){Re.fn[t]=function(t){var r=[],e=Re(t).map(function(t,e){var n=e.childNodes,i=n.length;if(i)return n[a?0:i-1];var o=document.createElement("div");return e.appendChild(o),r.push(o),o}),n=this[a?"insertBefore":"insertAfter"](e);return Re(r).remove(),n}}),Ce(["attr","prop","css"],function(r,a){function s(t,e){switch(r){case 0:var n=t.getAttribute(e);return ae(n)?void 0:n;case 1:return t[e];default:return ye(t,e)}}Re.fn[a]=function(n,i){var o=this;if(fe(n))return Ce(n,function(t,e){o[a](t,e)}),this;if(1!==arguments.length)return this.each(function(t,e){!function(t,e,n){if(!re(n))switch(r){case 0:ae(n)?t.removeAttribute(e):t.setAttribute(e,n);break;case 1:t[e]=n;break;default:e=pe(e),t.style[e]=oe(n)?n+(-1<_e.indexOf(e)?"":"px"):n}}(e,n,ne(i)?i.call(e,t,s(e,n)):i)});var t=this[0];return ue(t)?s(t,n):void 0}}),Re.fn.children=function(n){var i=[];return this.each(function(t,e){Ce(e.childNodes,function(t,e){ue(e)&&(n&&!Re(e).is(n)||i.push(e))})}),new we(We(i))},Re.fn.slice=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return new we([].slice.apply(this,t))},Re.fn.eq=function(t){var e=-1===t?this.slice(t):this.slice(t,+t+1);return new we(e)},Ce(["","s","sUntil"],function(n,t){Re.fn["parent"+t]=function(t,e){return Ke(n?Re(this.get().reverse()):this,n,"parentNode",t,e)}}),Re.fn.closest=function(n){if(this.is(n))return this;var i=[];return this.parents().each(function(t,e){if(Re(e).is(n))return i.push(e),!1}),new we(i)};var Xe=/^(?:{[\w\W]*\}|\[[\w\W]*\])$/;function Ge(t,e,n){if(re(n)&&1===t.nodeType){var i="data-"+he(e);if(ie(n=t.getAttribute(i)))try{n=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:Xe.test(t)?JSON.parse(t):t)}(n)}catch(t){}else n=void 0}return n}function Ve(e,n,t,i,o,r){function a(t){return ge(e,n.toLowerCase(),t)*r}return 2===i&&o&&(t+=a("margin")),ve(e)?(window.document.documentMode&&1===r&&(t+=a("border"),t+=a("padding")),0===i&&(t-=a("border")),1===i&&(t-=a("border"),t-=a("padding"))):(0===i&&(t+=a("padding")),2===i&&(t+=a("border"),t+=a("padding"))),t}function Je(t,e,n,i){var o="client"+e,r="scroll"+e,a="offset"+e,s="inner"+e;if(se(t))return 2===n?t[s]:de(document)[o];if(ce(t)){var c=de(t);return Math.max(t.body[r],c[r],t.body[a],c[a],c[o])}var u=parseFloat(me(t,e.toLowerCase())||"0");return Ve(t,e,u,n,i,1)}function Ye(t,e){return parseFloat(t.css(e))}function Qe(t){if(!t.getClientRects().length)return{top:0,left:0};var e=t.getBoundingClientRect(),n=t.ownerDocument.defaultView;return{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}}Re.fn.data=function(t,e){if(re(t)){if(!this.length)return;var n=this[0],i=qe(n);if(1!==n.nodeType)return i;for(var o=n.attributes,r=o.length;r--;)if(o[r]){var a=o[r].name;0===a.indexOf("data-")&&(i[a=pe(a.slice(5))]=Ge(n,a,i[a]))}return i}return fe(t)?this.each(function(){qe(this,t)}):2===arguments.length&&re(e)?this:re(e)?this.length?Ge(this[0],t,qe(this[0],t)):void 0:this.each(function(){qe(this,t,e)})},Re.fn.empty=function(){return this.each(function(){this.innerHTML=""})},Re.fn.extend=function(t){return Ce(t,function(t,e){Re.fn[t]=e}),this},Re.fn.filter=function(n){if(ne(n))return this.map(function(t,e){return n.call(e,t,e)?e:void 0});if(ie(n))return this.map(function(t,e){return Re(e).is(n)?e:void 0});var i=Re(n);return this.map(function(t,e){return-1<i.get().indexOf(e)?e:void 0})},Re.fn.first=function(){return this.eq(0)},Re.fn.has=function(t){var e=ie(t)?this.find(t):Re(t),n=e.length;return this.map(function(){for(var t=0;t<n;t+=1)if(Te(this,e[t]))return this})},Re.fn.hasClass=function(t){return this[0].classList.contains(t)},Ce(["Width","Height"],function(t,r){Ce(["inner"+r,r.toLowerCase(),"outer"+r],function(o,t){Re.fn[t]=function(n,t){var e=arguments.length&&(o<2||!function(t){return"boolean"==typeof t}(n)),i=!0===n||!0===t;return e?this.each(function(t,e){return function(t,e,n,i,o,r){var a=ne(r)?r.call(t,e,Je(t,n,i,o)):r;if(null!=a){var s=Re(t),c=n.toLowerCase();if(-1<["auto","inherit",""].indexOf(a))s.css(c,a);else{var u=a.toString().replace(/\b[0-9.]*/,"");a=Ve(t,n,parseFloat(a),i,o,-1)+(u||"px"),s.css(c,a)}}}(e,t,r,o,i,n)}):this.length?Je(this[0],r,o,i):void 0}})}),Re.fn.hide=function(){return this.each(function(){this.style.display="none"})},Ce(["val","html","text"],function(o,t){var r={0:"value",1:"innerHTML",2:"textContent"}[o];function a(t){if(2===o)return Fe(t,function(t){return de(t)[r]}).join("");if(t.length){var e=t[0];return 0===o&&Re(e).is("select[multiple]")?Fe(Re(e).find("option:checked"),function(t){return t.value}):e[r]}}Re.fn[t]=function(i){return arguments.length?this.each(function(t,e){var n=ne(i)?i.call(e,t,a(Re(e))):i;0===o&&Array.isArray(n)?Re(e).is("select[multiple]")?Fe(Re(e).find("option"),function(t){return t.selected=-1<n.indexOf(t.value)}):e.checked=-1<n.indexOf(e.value):function(t,e){if(re(e)){if(0!==o)return;e=""}1===o&&ue(e)&&(e=e.outerHTML),t[r]=e}(e,n)}):a(this)}}),Re.fn.index=function(t){return arguments.length?ie(t)?Re(t).get().indexOf(this[0]):this.get().indexOf(Re(t)[0]):this.eq(0).parent().children().get().indexOf(this[0])},Re.fn.last=function(){return this.eq(-1)},Ce(["","All","Until"],function(n,t){Re.fn["next"+t]=function(t,e){return Ke(this,n,"nextElementSibling",t,e)}}),Re.fn.not=function(t){var n=this.filter(t);return this.map(function(t,e){return-1<n.index(e)?void 0:e})},Re.fn.offsetParent=function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===Re(t).css("position");)t=t.offsetParent;return t||document.documentElement})},Re.fn.position=function(){if(this.length){var t,e=this.eq(0),n={left:0,top:0};if("fixed"===e.css("position"))t=e[0].getBoundingClientRect();else{t=e.offset();var i=e.offsetParent();(n=i.offset()).top+=Ye(i,"border-top-width"),n.left+=Ye(i,"border-left-width")}return{top:t.top-n.top-Ye(e,"margin-top"),left:t.left-n.left-Ye(e,"margin-left")}}},Re.fn.offset=function(e){return arguments.length?this.each(function(t){!function(t,e,n){var i=Re(t),o=i.css("position");"static"===o&&i.css("position","relative");var r,a,s=Qe(t),c=i.css("top"),u=i.css("left");if(("absolute"===o||"fixed"===o)&&-1<(c+u).indexOf("auto")){var l=i.position();r=l.top,a=l.left}else r=parseFloat(c),a=parseFloat(u);var f=ne(e)?e.call(t,n,je({},s)):e;i.css({top:null!=f.top?f.top-s.top+r:void 0,left:null!=f.left?f.left-s.left+a:void 0})}(this,e,t)}):this.length?Qe(this[0]):void 0},Re.fn.one=function(t,e,n,i){return this.on(t,e,n,i,!0)},Ce(["","All","Until"],function(n,t){Re.fn["prev"+t]=function(t,e){return Ke(n?Re(this.get().reverse()):this,n,"previousElementSibling",t,e)}}),Re.fn.removeAttr=function(t){var e=t.split(" ").filter(function(t){return t});return this.each(function(){var n=this;Ce(e,function(t,e){n.removeAttribute(e)})})},Re.fn.removeData=function(t){return this.each(function(){ze(this,t)})},Re.fn.removeProp=function(t){return this.each(function(){try{delete this[t]}catch(t){}})},Re.fn.replaceWith=function(i){return this.each(function(t,e){var n=i;ne(n)?n=n.call(e,t,e.innerHTML):t&&!ie(n)&&(n=Re(n).clone()),Re(e).before(n)}),this.remove()},Re.fn.replaceAll=function(t){var n=this;return Re(t).map(function(t,e){return Re(e).replaceWith(t?n.clone():n),n.get()})},Re.fn.serializeArray=function(){var a=[];return this.each(function(t,e){var n=e instanceof HTMLFormElement?e.elements:[e];Re(n).each(function(t,e){var n=Re(e),i=e.type,o=e.nodeName.toLowerCase();if("fieldset"!==o&&e.name&&!e.disabled&&-1<["input","select","textarea","keygen"].indexOf(o)&&-1===["submit","button","image","reset","file"].indexOf(i)&&(-1===["radio","checkbox"].indexOf(i)||e.checked)){var r=n.val();(Array.isArray(r)?r:[r]).forEach(function(t){a.push({name:e.name,value:t})})}})}),a},Re.fn.serialize=function(){return Me(this.serializeArray())};var Ze={};Re.fn.show=function(){return this.each(function(){"none"===this.style.display&&(this.style.display=""),"none"===ye(this,"display")&&(this.style.display=function(t){var e,n;return Ze[t]||(e=document.createElement(t),document.body.appendChild(e),n=ye(e,"display"),e.parentNode.removeChild(e),"none"===n&&(n="block"),Ze[t]=n),Ze[t]}(this.nodeName))})},Re.fn.siblings=function(t){return this.prevAll(t).add(this.nextAll(t))},Re.fn.toggle=function(){return this.each(function(){"none"===ye(this,"display")?Re(this).show():Re(this).hide()})};var tn=function(t){function e(){t.apply(this,arguments),this.active=!1,this.css_key="text-align",this.css_value="left"}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var i=this,t=this.selection.getRootElem();if(this.active)1==t.length&&(t.css(this.css_key,""),this.command.do("replaceRoot",t[0].outerHTML));else if(t.length)t.css(this.css_key,this.css_value),this.command.do("replaceRoot",t[0].outerHTML);else{var o=this.selection.getRange();if(o.collapsed)this.command.do("appendHTML",'<p style="${this.css_key}:${this.css_value};"><br></p>');else{var r=!1;this.$container.children().each(function(t,e){var n=Re(e);return r||(n.is(o.startContainer)||n[0].contains(o.startContainer)||i.$container.is(o.startContainer))&&(r=!0),!(r&&(n.css(i.css_key,i.css_value),n.is(o.endContainer)||n[0].contains(o.endContainer)))}),this.command.do("appendHTML","")}}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().css(this.css_key)==this.css_value,this.active},e}(Q);tn.icon="format_align_left",tn.title="居左";var en=function(t){function e(){t.apply(this,arguments),this.active=!1,this.css_key="text-align",this.css_value="center"}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var i=this,t=this.selection.getRootElem();if(this.active)1==t.length&&(t.css(this.css_key,""),this.command.do("replaceRoot",t[0].outerHTML));else if(t.length)t.css(this.css_key,this.css_value),this.command.do("replaceRoot",t[0].outerHTML);else{var o=this.selection.getRange();if(o.collapsed)this.command.do("appendHTML",'<p style="${this.css_key}:${this.css_value};"><br></p>');else{var r=!1;this.$container.children().each(function(t,e){var n=Re(e);return r||(n.is(o.startContainer)||n[0].contains(o.startContainer)||i.$container.is(o.startContainer))&&(r=!0),!(r&&(n.css(i.css_key,i.css_value),n.is(o.endContainer)||n[0].contains(o.endContainer)))}),this.command.do("appendHTML","")}}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().css(this.css_key)==this.css_value,this.active},e}(Q);en.icon="format_align_center",en.title="居中";var nn=function(t){function e(){t.apply(this,arguments),this.active=!1,this.css_key="text-align",this.css_value="right"}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var i=this,t=this.selection.getRootElem();if(this.active&&1==t.length&&(t.css(this.css_key,""),this.command.do("replaceRoot",t[0].outerHTML)),t.length)t.css(this.css_key,this.css_value),this.command.do("replaceRoot",t[0].outerHTML);else{var o=this.selection.getRange();if(o.collapsed)this.command.do("appendHTML",'<p style="${this.css_key}:${this.css_value};"><br></p>');else{var r=!1;this.$container.children().each(function(t,e){var n=Re(e);return r||(n.is(o.startContainer)||n[0].contains(o.startContainer)||i.$container.is(o.startContainer))&&(r=!0),!(r&&(n.css(i.css_key,i.css_value),n.is(o.endContainer)||n[0].contains(o.endContainer)))}),this.command.do("appendHTML","")}}},e.prototype.isActive=function(){return this.active=this.selection.getRootElem().css(this.css_key)==this.css_value,this.active},e}(Q);nn.icon="format_align_right",nn.title="居右";var on=function(t){function e(){t.apply(this,arguments),this.css_key="text-align",this.css_value=""}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onclick=function(){var i=this,t=this.selection.getRootElem();if(t.length)t.css(this.css_key,this.css_value),this.command.do("replaceRoot",t[0].outerHTML);else{var o=this.selection.getRange();if(o.collapsed)this.command.do("appendHTML",'<p style="${this.css_key}:${this.css_value};"><br></p>');else{var r=!1;this.$container.children().each(function(t,e){var n=Re(e);return r||(n.is(o.startContainer)||n[0].contains(o.startContainer)||i.$container.is(o.startContainer))&&(r=!0),!(r&&(n.css(i.css_key,i.css_value),n.is(o.endContainer)||n[0].contains(o.endContainer)))}),this.command.do("appendHTML","")}}},e.prototype.isActive=function(){return!1},e}(Q);on.icon="format_align_justify",on.title="清除align";var rn=function(n){function t(t,e){n.call(this,t,e),this.$input=D(),this.inputID=D.guid(),this.suffixs=[],this.accepts=[],this.setAccepts(),this.setInput(),this.bindInputChange(),this.bindKeyboardEvent()}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.bindKeyboardEvent=function(){var a=this;this.$container.on("keydown",function(t){var e=t.keyCode;a.selection.saveRange();var n=a.selection.getContainerElem();if(n.is("div")){if(8===e||46===e)if(n.hasClass("mdui_editor-content")){console.log(n);var i=!1,o=a.selection.getRange();a.$container.children().each(function(t,e){var n=D(e);return i||(n.is(o.startContainer)||n[0].contains(o.startContainer)||a.$container.is(o.startContainer))&&(i=!0),!(i&&(n.remove(),n.is(o.endContainer)||n[0].contains(o.endContainer)))})}else a.selection.createRangeByElem(n.next()),n.remove(),a.selection.restore();t.preventDefault()}if(13===e&&n.is("div")){var r=a.selection.getRootElem().next();r.length?(a.selection.createRangeByElem(r),a.selection.restore()):a.command.do("insertAfterRoot","<p><br></p>"),t.preventDefault()}}),this.$container.on("keyup",function(t){var e=t.keyCode,n=a.selection.getContainerElem();if((8===e||46===e)&&n.is("div")){var i=n.html().toLowerCase().trim();i&&"<br>"!==i&&"<br/>"!==i||n.html("")}})},t.prototype.setAccepts=function(){if(this.suffixs=this.editor.options.fileUploadSuffix,console.log(this.suffixs),0==this.suffixs.length);else{var e={zip:"application/x-zip-compressed"};this.accepts=this.suffixs.map(function(t){return e[t]})}},t.prototype.setInput=function(){0==this.accepts.length?this.$input=D('<input type="file" style="display: none;" id="'+this.inputID+'" name="'+this.editor.options.fileUploadName+'"/>').insertAfter(this.$button):this.$input=D('<input type="file" style="display: none;" id="'+this.inputID+'" name="'+this.editor.options.fileUploadName+'" accept="'+this.accepts.join(", ")+'"/>').insertAfter(this.$button)},t.prototype.bindInputChange=function(){var n=this;this.$input.on("change",function(t){var e=t.target.files;e.length&&(n.upload(e[0]),n.$input.val(""))})},t.prototype.upload=function(t){var e=this;if(0==this.accepts.length);else if(this.accepts.indexOf(t.type)<0)return void et.alert("仅允许上传 "+this.suffixs.join(", ")+" 格式的文件");if(this.editor.options.fileUploadMaxSize&&t.size>this.editor.options.fileUploadMaxSize)et.alert("文件体积不能超过 "+Ut(this.editor.options.fileUploadMaxSize));else{var n,i,o,r=new FormData;r.append(this.editor.options.fileUploadName,t),jt({url:this.editor.options.fileUploadUrl,method:"POST",data:r,processData:!1,dataType:"json",contentType:!1,global:!1,beforeSend:function(t){i=0,o=setInterval(function(){return i+=100},100);var e=(n=et.dialog({title:"上传中…",content:'<p class="mdui_editor-upload-progress">0%</p>',history:!1,modal:!0,cssClass:"mdui_editor-upload-progress-dialog"})).$element.find(".mdui_editor-upload-progress");t.upload.onprogress=function(t){e.html((t.loaded/t.total*100).toFixed(0)+"%")}},complete:function(){clearInterval(o),i<500?setTimeout(function(){n.close()},500-i):n.close()}}).then(function(o){if(e.editor.options.fileUploadResponseTransform&&(o=e.editor.options.fileUploadResponseTransform(o)),o.code)et.alert(o.message);else{var r=e;et.prompt("请输入文件名：",function(t){console.log("confirm"),console.log(t);var e=r.selection.getRootElem(),n=e.html().toLowerCase().trim(),i="<div onclick=\"window.open('"+o.data.url+'\')" class="mdui-chip mdui_editor-chip"><span class="mdui-chip-title">'+t+"</span></>";"P"!==e[0].nodeName||"<br>"!==n&&"<br/>"!==n?r.command.do("insertAfterRoot",i):r.command.do("replaceRoot",i),r.command.do("insertAfterRoot","<p><br></p>")},function(t){console.log("cancel"),console.log(t)})}}).catch(function(){return et.alert("文件上传失败")})}},t.prototype.onclick=function(){D("#"+this.inputID).trigger("click")},t}(Q);rn.icon="attach_file",rn.title="插入附件";var an={bold:tt,clear_drafts:wt,code:Rt,head:Tt,image:Bt,italic:It,link:Kt,ol:Gt,ul:Vt,h1:Jt,h2:Yt,h3:Qt,h4:Zt,h5:te,h6:ee,align_left:tn,align_center:en,align_right:nn,align_clear:on,upload_file:rn},sn=function(e){function t(t){e.call(this,t),this.menus={},this.init()}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.init=function(){var o=this;this.editor.options.menus.forEach(function(t){if("|"!==t)if(" "!==t){var e=an[t];if(e&&"function"==typeof e){var n=D('<button class="mdui-btn mdui_editor-toolbar-menu mdui_editor-toolbar-menu-'+t+'" type="button" title="'+e.title+'"><i class="mdui-icon material-icons">'+e.icon+"</i></button>").appendTo(o.$toolbar),i=new e(o.editor,n);o.menus[t]=i;n.on("click",function(){null!==o.selection.getRange()&&i.onclick()})}}else o.$toolbar.append('<div class="mdui-toolbar-spacer"></div>');else o.$toolbar.append('<div class="mdui_editor-toolbar-divider"></div>')})},t.prototype.changeStatus=function(){var n=this,i=[];j(this.menus,function(t,e){setTimeout(function(){e.isActive()?(e.$button.addClass("mdui_editor-toolbar-menu-active"),an[t].disable&&(i=i.concat(an[t].disable))):e.$button.removeClass("mdui_editor-toolbar-menu-active"),t===n.editor.options.menus[n.editor.options.menus.length-1]&&(i=I(i),j(n.menus,function(t,e){e.$button.prop("disabled",-1<i.indexOf(t))}))},0)})},t}(V);var cn=function(t){function e(){t.apply(this,arguments),this.currentRange=void 0}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getRange=function(){return this.currentRange},e.prototype.saveRange=function(t){if(t)this.currentRange=t;else{var e=window.getSelection();if(0!==e.rangeCount){var n=e.getRangeAt(0),i=this.getContainerElem(n);i.length&&this.$container[0].contains(i[0])&&(this.currentRange=n)}}},e.prototype.collapseRange=function(t){void 0===t&&(t=!1);var e=this.currentRange;e&&e.collapse(t)},e.prototype.getText=function(){return this.currentRange?this.currentRange.toString():""},e.prototype.getContainerElem=function(t){if(t=t||this.currentRange){var e=t.commonAncestorContainer;return D(1===e.nodeType?e:e.parentNode)}return D()},e.prototype.getRootElem=function(t){var e=this.getContainerElem(t);return this.$container.is(e)?D():e.parent().is(this.$container)?e:e.parentsUntil(this.$container).last()},e.prototype.isEmpty=function(){var t=this.currentRange;return!(!t||!t.startContainer)&&(t.startContainer===t.endContainer&&t.startOffset===t.endOffset)},e.prototype.restore=function(){var t=window.getSelection();t.removeAllRanges(),t.addRange(this.currentRange)},e.prototype.createEmptyRange=function(t){void 0===t&&(t="strong");var e,n=this.getRange();if(n&&this.isEmpty())try{/webkit/i.test(navigator.userAgent)?(this.command.do("insertHTML","&#8203;"),n.setEnd(n.endContainer,n.endOffset+1),this.saveRange(n)):(e=D("<"+t+">&#8203;</"+t+">"),this.command.do("insertElem",e),this.createRangeByElem(e,!0))}catch(t){}},e.prototype.createRangeByElem=function(t,e,n){if(void 0===e&&(e=!1),void 0===n&&(n=!1),t.length){var i=t[0],o=document.createRange();n?o.selectNodeContents(i):o.selectNode(i),o.collapse(e),this.saveRange(o)}},e}(V);function un(t){return Et(function(t){var e=t.clipboardData||t.originalEvent&&t.originalEvent.clipboardData,n="",i="";return null===e?n=window.clipboardData&&window.clipboardData.getData("text"):(n=e.getData("text/plain"),i=e.getData("text/html")),{pasteText:n,pasteHtml:i}}(t).pasteText)}function ln(t,e,n){void 0===n&&(n={}),this.options=U({},fn),this.change=null,U(this.options,n),this.$toolbar=D(t).first().addClass("mdui_editor-toolbar"),this.$toolbar=D(t).first().css("overflow","auto"),this.$container=D(e).first().addClass("mdui_editor-content mdui-typo").attr({contenteditable:"",placeholder:this.options.placeholder}),this.command=new Y(this),this.selection=new cn(this),this.menus=new sn(this),this.options.autoSave&&this.setHTML(window.localStorage.getItem(this.options.autoSaveKey)||""),this.initSelection(!0),this.bindEvent(),this.command.do("defaultParagraphSeparator","p");try{this.command.do("AutoUrlDetect",!1)}catch(t){}}var fn={onchange:function(){},onClearDrafts:function(){},onchangeTimeout:200,placeholder:"说点什么",menus:["bold","italic","code","ol","ul","link","image","|","h1","h2","h3","h4","h5","h6","|","align_left","align_center","align_right","align_clear","upload_file"," ","clear_drafts"],tagsWhiteList:["p","strong","b","em","i","h1","h2","h3","h4","h5","h6","pre","code","ol","ul","li","a","img","figure","figcaption","div"],autoSave:!1,autoSaveKey:"mdui-editor-content",imageUploadUrl:"",imageUploadMaxSize:2097152,imageUploadSuffix:["png","jpg","gif"],imageUploadName:"file",imageUploadResponseTransform:!1,fileUploadUrl:"",fileUploadMaxSize:2097152,fileUploadSuffix:["zip"],fileUploadName:"file",fileUploadResponseTransform:!1};return ln.prototype.initSelection=function(t){void 0===t&&(t=!1);var e=this.$container.children();if(!e.length)return this.$container.append("<p><br></p>"),this.initSelection();var n=e.last();if(t){var i=n.html().toLowerCase(),o=n[0].nodeName;if("<br>"!==i&&"<br/>"!==i||"P"!==o)return this.$container.append("<p><br></p>"),this.initSelection()}this.updatePlaceholder(),this.selection.createRangeByElem(n,!1,!0),this.selection.restore()},ln.prototype.getHTML=function(){return this.$container.html().replace(/\u200b/gm,"")},ln.prototype.setHTML=function(t){this.$container.html(t),this.initSelection()},ln.prototype.getText=function(){return this.$container.text().replace(/\u200b/gm,"")},ln.prototype.setText=function(t){this.setHTML(t?"<p>"+t+"</p>":"<p><br></p>")},ln.prototype.clear=function(){this.setHTML("<p><br></p>")},ln.prototype.focus=function(){this.initSelection()},ln.prototype.bindEvent=function(){var t=this,e=!0;this.$container.on("compositionstart",function(){e=!1}).on("compositionend",function(){e=!0}).on("click keyup",function(){e&&t.change&&t.change()}),this.$toolbar.on("click",function(){t.change&&t.change()}),this.bindChange(),this.saveRangeRealTime(),this.pasteHandler(),this.deleteHandler(),this.containerClickHandler(),this.dragHandler(),this.undoHandler()},ln.prototype.updatePlaceholder=function(){var t="mdui_editor-content-empty";"<p><br></p>"===this.$container.html()?this.$container.addClass(t):this.$container.removeClass(t)},ln.prototype.bindChange=function(){var e=this,n=this.options,i=n.onchangeTimeout,o=0,r=this.getHTML();this.change=function(){var t=e.getHTML();t!==r&&(o&&clearTimeout(o),o=setTimeout(function(){n.onchange(e),r=t,n.autoSave&&window.localStorage.setItem(n.autoSaveKey,e.getHTML()),e.updatePlaceholder()},i))}},ln.prototype.saveRangeRealTime=function(){function t(){e.selection.saveRange(),e.menus.changeStatus()}var e=this;this.$container.on("keyup",t).on("mousedown",function(){e.$container.on("mouseleave",t)}).on("mouseup",function(){t(),e.$container.off("mouseleave",t)})},ln.prototype.pasteHandler=function(){var r=this;this.$container.on("paste",function(t){t.preventDefault();var e=function(t){var e="";return t.split("\n").forEach(function(t){t=t.replace(/[\r\n]/gm,""),e+=t?"<p>"+t+"</p>":"<p><br></p>"}),e}(un(t)),n=un(t),i=r.selection.getContainerElem();if(i.length){var o=i[0].nodeName;if("CODE"!==o&&"PRE"!==o){if(e)try{r.command.do("insertHTML",e)}catch(t){r.command.do("insertHTML",n)}}else r.command.do("insertHTML",n)}})},ln.prototype.deleteHandler=function(){var o=this;this.$container.on("keydown keyup",function(t){var e=t.keyCode,n=t.type;if(8===e||46===e){var i=o.$container.html().toLowerCase().trim();"keydown"===n&&("<p><br></p>"===i?t.preventDefault():i||(o.$container.html("<p><br></p>"),t.preventDefault())),"keyup"===n&&(i||o.$container.html("<p><br></p>"))}o.updatePlaceholder()})},ln.prototype.containerClickHandler=function(){var i=this;this.$container.on("click",function(t){var e=t.target;if(D(e).is(i.$container)){var n=i.$container.children().last();n.length&&"P"===n[0].nodeName||i.command.do("appendHTML","<p><br></p>")}})},ln.prototype.dragHandler=function(){this.$container.on("dragleave drop dragenter dragover",!1)},ln.prototype.undoHandler=function(){this.$container.on("keydown",function(t){if(t.ctrlKey&&90===t.keyCode)return!1})},ln});
//# sourceMappingURL=editor.min.js.map
